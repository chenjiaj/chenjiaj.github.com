<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>Vue2+koa2构建单页应用（一）- 开发环境打包与配置 | </title>
    <meta name="author" content="chenjiajun">
    
    <meta name="description" content="之前用Vue2+webpack+express构建单页应用，发现node端不能用es6的语法，为了前后端都用上es6的语法，node框架决定尝试koa2
代码地址：https://github.com/chenjiaj/Vue2-koa2-demo
一、需要环境node版本在7及以上选择新版本的环境">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="Vue2+koa2构建单页应用（一）- 开发环境打包与配置">
    <meta property="og:site_name" content="chenjiajun">

    
    <meta property="og:image" content="undefined">
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="chenjiajun" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
</html>

<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="light-blue accent-4">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">chenjiajun</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-reading " href="/reading" >
                            <i class="fa fa-book "></i>
                            
                            读书
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav light-blue darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://upload.jianshu.io/users/upload_avatars/1210894/9f3436e83320?imageMogr/thumbnail/90x90/quality/100" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">chenjiajun</p>
                        <p class="desc">Web前端</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-reading " href="/reading" >
                    <i class="fa fa-book "></i>
                    
                    读书
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav light-blue darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/插件/">
                    插件 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/vue/">
                    vue <span class="right">5 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/js/">
                    js <span class="right">4 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/mysql/">
                    mysql <span class="right">3 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/node/">
                    node <span class="right">2 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/css/">
                    css <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/sublime/">
                    sublime <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/hexo/">
                    hexo <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/微信/">
                    微信 <span class="right">4 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/canvas/">
                    canvas <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/工具/">
                    工具 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/总结/">
                    总结 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/感悟/">
                    感悟 <span class="right">1 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper light-blue accent-4">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/vue/">vue</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>Vue2+koa2构建单页应用（一）- 开发环境打包与配置</h1>
    


            </div>
            <time class="pink-link-context" datetime="2017-08-18T08:26:00.000Z"><a href="/2017/08/18/Vue2+koa2构建单页应用（一）--开发环境打包与配置/">2017-08-18</a></time>

            
    <div class="tags-row">
        
            <a href="/tags/vue/" class="chip pink lighten-1">vue</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#一、需要环境"><span class="section table-of-contents-text">一、需要环境</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#二、创建基本项目"><span class="section table-of-contents-text">二、创建基本项目</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#1-1-启动koa小项目demo"><span class="section table-of-contents-text">1.1 启动koa小项目demo</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#1-2-添加vue页面，实现hello-world"><span class="section table-of-contents-text">1.2 添加vue页面，实现hello world</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#1-3-添加webpack打包文件与配置"><span class="section table-of-contents-text">1.3 添加webpack打包文件与配置</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#三、添加路由实现单页"><span class="section table-of-contents-text">三、添加路由实现单页</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#1-1-vue添加路由"><span class="section table-of-contents-text">1.1 vue添加路由</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#1-2-配置node端端"><span class="section table-of-contents-text">1.2 配置node端端</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#1-3-优化"><span class="section table-of-contents-text">1.3 优化</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#1-添加less配置，让-vue文件支持写less文件"><span class="section table-of-contents-text">1.添加less配置，让.vue文件支持写less文件</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#2-实现懒加载，优化初始化加载"><span class="section table-of-contents-text">2.实现懒加载，优化初始化加载</span></a></li></ol></li></ol></li></ol>
</div>


            <div class="entry pink-link-context">
                <p>之前用Vue2+webpack+express构建单页应用，发现node端不能用es6的语法，为了前后端都用上es6的语法，node框架决定尝试koa2</p>
<p>代码地址：<a href="https://github.com/chenjiaj/Vue2-koa2-demo" target="_blank" rel="noopener">https://github.com/chenjiaj/Vue2-koa2-demo</a></p>
<h2 id="一、需要环境"><a href="#一、需要环境" class="headerlink" title="一、需要环境"></a>一、需要环境</h2><p>node版本在7及以上<br>选择新版本的环境是为了node端不用引入babel对es6做处理，新的node版本对es6有良好的支持。</p>
<h2 id="二、创建基本项目"><a href="#二、创建基本项目" class="headerlink" title="二、创建基本项目"></a>二、创建基本项目</h2><h3 id="1-1-启动koa小项目demo"><a href="#1-1-启动koa小项目demo" class="headerlink" title="1.1 启动koa小项目demo"></a>1.1 启动koa小项目demo</h3><p>1.新建文件夹koa2+vue2-demo，然后进入文件夹，打开cmd进入文件夹内的目录或者webstorm的命令面板。</p>
<p>2.执行npm init命令生成package.json文件,然后执行npm install koa koa-onerror –save 下载koa和 koa-onerror</p>
<p>3.在项目根目录下新建config文件夹,然后进入文件夹新建config.js，输入以下内容，配置端口号</p>
<pre><code>module.exports = {
    node: {
    port: 3011
}
</code></pre><p>  };    </p>
<p>4.在项目根目录新建app.js文件，然后输入以下内容，创建一个基本的项目</p>
<pre><code>const Koa = require(&apos;koa&apos;);
const app = new Koa();
const Config = require(&apos;./config/config&apos;);
const onerror = require(&apos;koa-onerror&apos;);

//错误信息处理
onerror(app);

//控制台打印请求信息
app.use(async(ctx, next) =&gt; {
    const start = Date.now();
    await next();
    const ms = Date.now() - start;
    console.log(`${ctx.method} ${ctx.url} - ${ms}ms`);
});

app.listen(Config.node.port);
</code></pre><ol start="5">
<li>修改package.json,在script对象中添加 “start”: “node ./app.js”，如下图所示</li>
</ol>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/1.png" alt="Paste_Image.png"></p>
<p>6.此时在命令面板中输入npm start即可启动项目，然后在浏览器中访问 <a href="http://localhost:3011/，因为现在还没有对请求做任何处理，所以返回not" target="_blank" rel="noopener">http://localhost:3011/，因为现在还没有对请求做任何处理，所以返回not</a> found。</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/2.png" alt="Paste_Image.png"></p>
<h3 id="1-2-添加vue页面，实现hello-world"><a href="#1-2-添加vue页面，实现hello-world" class="headerlink" title="1.2 添加vue页面，实现hello world"></a>1.2 添加vue页面，实现hello world</h3><p>1.在根目录下新建src,然后在src下添加index.html文件,并且添加一个id为app的div，如下。同时在命令面板输入 npm install vue –save</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/3.png" alt="Paste_Image.png"></p>
<p>2.在src目录下新建views文件夹（存放所有的.vue文件），并在此文件夹下添加app.vue文件。在app.vue写入一下代码：</p>
<pre><code>&lt;template&gt;
    &lt;div&gt;hello world!&lt;/div&gt;
&lt;/template&gt;
</code></pre><p>3.在src下新建main.js作为vue的入口文件。在main.js中添加以下内容：</p>
<pre><code>import Vue from &apos;vue&apos;;
import App from &apos;./views/app.vue&apos;;

new Vue({
  el: &apos;#app&apos;,
  render: h=&gt; h(App)
});
</code></pre><p>现在目录结构如下：<br><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/4.png" alt="Paste_Image.png"></p>
<p>一个hello world 的demo就写好了，但是要在浏览器看到效果，还需要引入vue包，同时也需要添加webpack打包需要的文件与配置。将vue内容打包引入index.html中，然后再将node接收到的页面请求返回打包后的index.html页面</p>
<h3 id="1-3-添加webpack打包文件与配置"><a href="#1-3-添加webpack打包文件与配置" class="headerlink" title="1.3 添加webpack打包文件与配置"></a>1.3 添加webpack打包文件与配置</h3><p>1.下载webpack打包需要的依赖包</p>
<pre><code>npm install webpack webpack-merge koa-webpack extract-text-webpack-plugin html-webpack-plugin css-loader file-loader vue-template-compiler vue-loader vue-style-loader  --save-dev
</code></pre><p><strong>webpack</strong> ：webpack打包需要引入的核心包</p>
<p><strong>koa-webpack</strong>：封装了webpack-dev-middleware和webpack-hot-middleware两个插件</p>
<p>webpack-dev-middleware是需要webpack打包的项目，开发时使用的中间件，主要作用是不需要将打包生成的文件放在硬盘中，而是放在内存中，这样可以提高开发效率，而且配合webpack-hot-middleware中间件使用可以实现热加载</p>
<p><strong>extract-text-webpack-plugin</strong>：主要是为了抽离css样式,防止将样式打包在js中引起页面样式加载错乱的现象</p>
<p><strong>html-webpack-plugin</strong>：是webpack的插件，这个插件用来简化创建服务于 webpack bundle 的 HTML 文件，尤其是对于在文件名中包含了 hash 值，而这个值在每次编译的时候都发生变化的情况。你既可以让这个插件来帮助你自动生成 HTML 文件，也可以使用 lodash 模板加载生成的 bundles，或者自己加载这些 bundles。</p>
<p><strong>vue-loader</strong>：是webpack的loader,能够将.vue文件转换成js文件</p>
<p><strong>vue-html-loader、vue-template-compiler、css-loader、vue-style-loader</strong>：这三个都是webpack的loader,都是将.vue文件转换成js文件的依赖</p>
<p>2.下载babel需要的依赖包</p>
<pre><code>npm install babel-core babel-loader babel-plugin-transform-runtime babel-polyfill babel-preset-es2015 babel-preset-stage-0 babel-runtime   --save-dev
</code></pre><p><strong>以babel-开头</strong>：都是用于兼容es6写法，将es6的代码转换成es5的代码<br><strong>babel-core、babel-loader</strong>：babel配合webpack工具使用必须要引入的<br><strong>babel-plugin-transform-runtime、babel-runtime</strong>：解决重复出现在一些模块里，导致编译后的代码体积变大的问题。<br><strong>babel-preset-es2015</strong>：将 ES2015 编译成 ES5<br><strong>babel-preset-stage-2</strong>：除了覆盖stage-3的所有功能,不是对ES6功能的增加，而是为了增强代码的可读性和可修改性而提出的参考：<a href="http://babeljs.io/docs/setup/#installation" target="_blank" rel="noopener">http://babeljs.io/docs/setup/#installation</a></p>
<p>3.在根目录下添加.babelrc文件，添加以下配置：</p>
<pre><code>{
      &quot;presets&quot;: [&quot;es2015&quot;,&quot;stage-0&quot;],
      &quot;plugins&quot;: [&quot;transform-runtime&quot;],
      &quot;comments&quot;: false
 }
</code></pre><p>4.在根目录下新建build文件夹，然后添加webpack.base.conf.js、webpack.dev.conf.js、webpack.prod.conf.js<br>webpack.base.conf.js：开发和生成环境相同配置写字这个里边<br>webpack.dev.conf.js：针对开发时配置的文件<br>webpack.prod.conf.js：针对生产环境（正式上线）配置的文件</p>
<p>5.在webpack.base.conf.js中添加以下配置</p>
<pre><code> /* 引入操作路径模块和webpack */
const path = require(&apos;path&apos;);
const webpack = require(&apos;webpack&apos;);
const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;);
const ExtractTextPlugin = require(&apos;extract-text-webpack-plugin&apos;);

module.exports = {
/* 输入文件 */
entry: {
    index: [&apos;babel-polyfill&apos;, path.resolve(__dirname, &apos;../src/main.js&apos;)]
},
output: {
    /* 输出目录，没有则新建 */
    path: path.resolve(__dirname, &apos;../dist&apos;),
    /* 静态目录，可以直接从这里取文件 */
    publicPath: &apos;/&apos;,
    /* 文件名 */
    filename: &apos;js/[name].[hash].js&apos;,
    chunkFilename: &apos;js/[name].[chunkhash].js&apos;
},
module: {
    rules: [{
        test: /\.vue$/,
        loader: &apos;vue-loader&apos;,
        options: {
            loaders: {
                css: ExtractTextPlugin.extract({
                    use: &apos;css-loader&apos;,
                    fallback: &apos;vue-style-loader&apos; // &lt;- this is a dep of vue-loader, so no need to explicitly install if using npm3
                })
            }
        }
    }, {//页面中import css文件打包需要用到
        test: /\.css/,
        loader: ExtractTextPlugin.extract({ fallback: &apos;style-loader&apos;, use: &apos;css-loader&apos; })
    }, {
        test: /\.js$/,
        loader: &apos;babel-loader&apos;,
        /* 排除模块安装目录的文件 */
        exclude: /node_modules/
    },{
        test: /\.png$|\.jpg$|\.gif$|\.ico$/,
        loader: &quot;file-loader&quot;,
        exclude: /node_modules/
    }]
},
plugins: [
    new HtmlWebpackPlugin({
        filename: &apos;index.html&apos;,
        template: path.resolve(__dirname, &apos;../src/index.html&apos;),
        inject: true
    }),
    new ExtractTextPlugin(&quot;style.css&quot;)
]
</code></pre><p>};</p>
<p>6.我们先配置开发是需要文件，生成环境之后再近些配置。<br>首先在webpack.dev.conf.js中添加</p>
<pre><code>const merge = require(&apos;webpack-merge&apos;);
const baseConfig = require(&apos;./webpack.base.conf&apos;);
const webpack = require(&apos;webpack&apos;);

let devConfig =  merge(baseConfig, {
output: {
    path: &apos;/&apos;
},
plugins: [
    new webpack.HotModuleReplacementPlugin(),
    new webpack.NoEmitOnErrorsPlugin()
]
});

module.exports = devConfig;
</code></pre><p>7.然后在app.js中添加webpack配置，如下</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/5.png" alt="Paste_Image.png"></p>
<p>8.然后运行npm start启动项目，看到打印出一下日志，证明启动成功</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/6.png" alt="Paste_Image.png"></p>
<p>9.在浏览器中访问<a href="http://localhost:3011/，效果如下，vue" target="_blank" rel="noopener">http://localhost:3011/，效果如下，vue</a> + koa构建一个hello world的小项目就成功了。</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/7.png" alt="Paste_Image.png"></p>
<h2 id="三、添加路由实现单页"><a href="#三、添加路由实现单页" class="headerlink" title="三、添加路由实现单页"></a>三、添加路由实现单页</h2><h3 id="1-1-vue添加路由"><a href="#1-1-vue添加路由" class="headerlink" title="1.1 vue添加路由"></a>1.1 vue添加路由</h3><p>1.下载路由的依赖包 npm install vue-router –save</p>
<p>2.在src文件夹下添加router文件夹，然后新建index.js,存放路由主要配置</p>
<p>3.在views文件夹下，添加example文件，然后添加两个文件，分别是example.vue和example1.vue，作为路由中的两个页面。分别添加以下内容：</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/8.png" alt="Paste_Image.png"></p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/9.png" alt="Paste_Image.png"></p>
<p>4.在router下的index.js编辑以下内容：</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/10.png" alt="Paste_Image.png"></p>
<p>5.修改main.js如下，将路由：</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/11.png" alt="Paste_Image.png"></p>
<p>6.修改app.vue，配置的路由中的compent将显示在router-view中</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/12.png" alt="Paste_Image.png"></p>
<p>7.刷新浏览器，可以看到以下效果</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/13.png" alt="Paste_Image.png"></p>
<p>点击example1将显示(点击example1跳转并未刷新页面，只是vue的路由跳转)</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/14.png" alt="."></p>
<p>8.但是在<a href="http://localhost:3011/example1下刷新浏览器，现在会发现找不到" target="_blank" rel="noopener">http://localhost:3011/example1下刷新浏览器，现在会发现找不到</a></p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/15.png" alt="Paste_Image.png"></p>
<p>这是什么原因造成的呢？</p>
<p>因为vue的路由是在浏览器中进行管理，如果刷新<a href="http://localhost:3011/时可以访问到的，因为请求/路径，node将其指向了index.html(因为webpack打包会把index.html打包到根目录，而koa-webpack在没有传递参数的情况下也是指向的webpack配置文件中output中的publicPath，配置文件中配置的是/，所以默认/请求指向index.html),以下是koa-webpack中默认配置的源代码" target="_blank" rel="noopener">http://localhost:3011/时可以访问到的，因为请求/路径，node将其指向了index.html(因为webpack打包会把index.html打包到根目录，而koa-webpack在没有传递参数的情况下也是指向的webpack配置文件中output中的publicPath，配置文件中配置的是/，所以默认/请求指向index.html),以下是koa-webpack中默认配置的源代码</a></p>
<p>![Paste_Image.png](<a href="http://upload-images.jianshu.io/upload_images/1210894-bb4f6395ba003114.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240z" target="_blank" rel="noopener">http://upload-images.jianshu.io/upload_images/1210894-bb4f6395ba003114.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240z</a></p>
<p>而/example1请求到node，node会去寻找node端的路由处理，因为node端没有配置这个路由，所有找不到。</p>
<p>如果想要访问到/example1，需要请求到index.html,然后由vue的路由处理找到对应的模块</p>
<p>解决方法有：</p>
<p>（1）vue路由采用hash模式，修改router下的index.js文件，将mode的值改为hash，如果是hash，但是这样浏览器路径会变成<a href="http://localhost:3011/#/example1，有一点丑陋，http://localhost:3011/#/example1这个路径还是请求的/后面的会被当做参数处理" target="_blank" rel="noopener">http://localhost:3011/#/example1，有一点丑陋，http://localhost:3011/#/example1这个路径还是请求的/后面的会被当做参数处理</a></p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/16.png" alt="Paste_Image.png"></p>
<p>（2）将所有html请求转到index.html 然后让vue的浏览器处理</p>
<h3 id="1-2-配置node端端"><a href="#1-2-配置node端端" class="headerlink" title="1.2 配置node端端"></a>1.2 配置node端端</h3><p>1.将所有的html请求转到index.html,有一个现成的插件connect-history-api-fallback替我们做了这件事，但是需要稍微封装一下才能在koa2中使用。<br>（1）npm install connect-history-api-fallback –save 下载插件包<br>（2）在根目录下添加middleware文件夹，用于存放koa的中间件<br>（3）在middleware文件夹中添加koa2-connect-history-api-fallback.js 文件，koa2中间件需要传入需要的方法，所以封装返回了一个方法</p>
<pre><code>const history = require(&apos;connect-history-api-fallback&apos;);
module.exports = options=&gt; {
    const middleware = history(options);
    const noop = ()  =&gt; {
    };

    return async (ctx, next)=&gt; {
      middleware(ctx, null, noop);
    await next();
    };
};
</code></pre><p>2.在app.js添加const history = require(‘./middleware/koa2-connect-history-api-fallback’);和<br>app.use(history({<br>    verbose: true//打出转发日志<br>}));<br>注意：app.use(history(…))要写在app.use(middleware({…}))之前，不然koa-webpack已经返回not found了，app.use(history(…))就不会生效了</p>
<p>11.写好之后重启服务，然后访问浏览器刷新<a href="http://localhost:3011/example1就可以访问到了" target="_blank" rel="noopener">http://localhost:3011/example1就可以访问到了</a><br>并且可以看到日志，只有请求html转到了index.html</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/17.png" alt="Paste_Image.png"></p>
<h3 id="1-3-优化"><a href="#1-3-优化" class="headerlink" title="1.3 优化"></a>1.3 优化</h3><h4 id="1-添加less配置，让-vue文件支持写less文件"><a href="#1-添加less配置，让-vue文件支持写less文件" class="headerlink" title="1.添加less配置，让.vue文件支持写less文件"></a>1.添加less配置，让.vue文件支持写less文件</h4><p>（1）下载less打包编译需要的依赖，npm install less less-loader –save-dev<br>（2）在webpack.base.conf.js中配置，添加这两个配置，将会识别.vue里边的less,也可以将less写成单独的文件</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/18.png" alt="Paste_Image.png"></p>
<p>（3）在页面中引入less文件（通常便于维护，less写在单独文件中）<br>在src文件夹中添加static文件夹，然后在static文件夹中添加less文件，专门存放less文件，然后添加example.less文件，顺便写一些样式进去，如下</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/19.png" alt="Paste_Image.png"></p>
<p>然后在example.vue文件中引入这个less文件</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/20.png" alt="Paste_Image.png"></p>
<p>页面效果如下</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/21.png" alt="Paste_Image.png"></p>
<h4 id="2-实现懒加载，优化初始化加载"><a href="#2-实现懒加载，优化初始化加载" class="headerlink" title="2.实现懒加载，优化初始化加载"></a>2.实现懒加载，优化初始化加载</h4><p>在页面比较多的时，单页应用按照之前的方式打包成一个js会导致首页加载时很慢，为了解决这个问题，可以修改打包，让首页只加载通用代码和首页要用到的代码，跳转到其他页面再加载对应页面的js，这样可以解决项目较大首页加载缓慢的问题。</p>
<p>修改router中index.js,将.vue文件加载改为<br>const Example = r =&gt; require.ensure([], () =&gt; r(require(‘../views/example/example.vue’)), ‘Example’);<br>const Example1 = r =&gt; require.ensure([], () =&gt; r(require(‘../views/example/example1.vue’)), ‘Example1’);</p>
<p>因为webpack.base.conf.js已经加了chunkFilename: ‘js/[name].[chunkhash].js’，所以不用再修改webpack配置</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/22.png" alt="Paste_Image.png"></p>
<p>浏览页面，这个时候会发现，访问example页面只有example.js</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/23.png" alt="Paste_Image.png"></p>
<p>点击example1页面，才会新加入example1.js，并且加载之后，以后返回example1页面不会重新加载，提高性能</p>
<p><img src="/images/Vue2+koa2构建单页应用（一）--开发环境打包与配置-img/24.png" alt="Paste_Image.png"></p>
<p>经过以上步骤，我们已经可以在本地跑起来开发vue项目了。</p>

            </div>
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="menu"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer light-blue accent-4 darken-1">
    
    <div class="container">
        <div class="row">
            
            <div class="social-group col m3 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="https://github.com/chenjiaj" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="http://www.jianshu.com/users/b16dec48b1fe/latest_articles" target="_blank">
                        <i class="fa fa-2x fa-book"></i>
                    </a>
                
            </div>
            

            
            <div class="col m9 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://www.jianshu.com/users/b16dec48b1fe/latest_articles" target="_blank">我的简书</a>
                
                    <a class="social-link" href="https://github.com/chenjiaj" target="_blank">我的Github</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2016 example.com, All rights reserved.
            <p class="right" style="margin-top: 0;">本博客由 <a href="https://hexo.io">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();
            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('.menu-search').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
